---
title: "Eight Simple Rules for Maintainable Javascript"
kind: article
created_at: 2012-06-30 10:41:00 UTC
author: Tejas Dinkar
layout: post
---
<p>All projects start out small. This is true for the javascript part of any web app. In the beginning, it&#39;s always easy to read, and easy to debug.</p> <p>I&#39;ve put together some of my learnings for client side Javascript</p> <h2>1. Do not let your .js file be the entry point to your code</h2> <p>I&#39;ve seen this anti pattern in most of the codebases I&#39;ve inherited.</p> <p><em>The Trap:</em>The javascript that binds to the DOM <script src="https://gist.github.com/3023040.js?file=trap1.js"></script><noscript>  <pre>$(&quot;.submit-button&quot;).click(function(){<br />  server.submit();<br />});</pre></noscript></p> <p>This is a trap for multiple reasons:</p> <ol><li>It&#39;s really hard to figure out what happened when you clicked on a button. Did some callback get triggered? Where is the code for this?</li><li>You&#39;ll can easily get a bunch of callbacks that interfere with each other. Another page of mine has another button called submit button. I need to make sure that this JS is not loaded on that page</li><li>It&#39;s not possible to compile all your javascript assets into a single application.js</li></ol> <p><em>Solution:</em>Wrap everything that is binding to an element, and call that from the html <script src="https://gist.github.com/3023040.js?file=solution1.js"></script><noscript>  <pre>function bindElementToSubmit(element) {<br />  element.click(function() {<br />    server.submit();<br />  });<br />}</pre></noscript> <script src="https://gist.github.com/3023040.js?file=solution1.html"></script><noscript>  <pre>&lt;div class=&quot;submit-button&quot;&gt;Submit&lt;/div&gt;<br />&lt;script type=&quot;text/javascript&quot;&gt;<br />  bindElementToSubmit($(&quot;.submit-button&quot;));<br />&lt;/script&gt;</pre></noscript></p> <p>Binding things in the HTML helps you keep in your head what is going on in a particular page. It also helps you answer things like how an element is bound (was it &quot;.submit-button&quot;, &quot;#page-submit-button&quot;, or &quot;form &gt; .submit-button&quot;), and makes sure that it&#39;s easy to find when searching for code later.</p> <p><em>Caveat:</em>One caveat to look out for is the order of loading of JavaScript files. The above code requires jQuery loaded for $(document).ready() to work. One alternative is to use window.onLoad(), though that waits for the entire DOM and assets to load.</p> <h2>2. Understand how <em>this</em> works in Javascript</h2> <p>Everything is lexically scoped in Javascript. Except for &#39;this&#39;, which is something that is set depending on how a method is called. Some libraries like jQuery even set the value of &#39;this&#39; to mean things like the object on which a callback is called.</p> <p><em>The Trap:</em>Using a this pointer that&#39;s pointing at the wrong object. <script src="https://gist.github.com/3023040.js?file=trap2.js"></script><noscript>  <pre>$(&quot;some-div&quot;).click(function() {<br />  this.html(&quot;loading&quot;); // replaces the current div with 'loading'<br />  $.get(&quot;/foobar&quot;, function(result){<br />    this.html(result); // no such function html!!<br />  });<br />});</pre></noscript></p> <p>Granted, this isn&#39;t all that dangerous because it will be obvious that your code is not working.</p> <p><em>The Solution:</em>Have a convention for what the current object is. I prefer self. <script src="https://gist.github.com/3023040.js?file=solution2.js"></script><noscript>  <pre>$(&quot;some-div&quot;).click(function() {<br />  var self = this;<br />  self.html(&quot;loading&quot;);<br />  $.get(&quot;/foobar&quot;, function(result){<br />    self.html(result);<br />  });<br />});</pre></noscript></p> <h2>3. Structure your JS code into logical units</h2> <p>Javascript is a prototype based language. There are a lot of cool things you can do with a prototype based language, but very few of them will help you write a good UI. Most people take the lack of &#39;class&#39; keyword in Javascript to mean the lack of Object Orientation.</p> <p><em>The Trap:</em>A bunch of methods floating around in space <script src="https://gist.github.com/3023040.js?file=trap3.js"></script><noscript>  <pre>function processResults(results) {<br />  // do Something<br />}<br /><br />function bindElementToSubmit(element) {<br />  element.click(function(){<br />    server.submit(function(result){<br />      processResults(results);<br />    });<br />  });<br />}<br /><br />bindElementToSubmit($(&quot;.submit-button&quot;));</pre></noscript></p> <p>This is a trap because you aren&#39;t able to group logically related methods together. This would be similar to a bunch of static methods on your server side.</p> <p><em>The Solution:</em>Build some sort of object oriented abstraction over your javascript functions. You can either hand roll your own using javascripts prototype functionality, or you can just drop in something like <a href="https://github.com/rauschma/class-js/blob/master/Class.js">class-js</a><script src="https://gist.github.com/3023040.js?file=solution3.js"></script><noscript>  <pre>SubmitPage = Class.extend({<br />  processResults: function(results) {<br />    // do Something<br />  },<br /><br />  constructor: function(element) {<br />    var self = this;<br />    element.click(function(){<br />      server.submit(function(result){<br />       self.processResults(results);<br />      });<br />    });   <br />  }<br />});<br /><br />new SubmitPage($(&quot;.submit-button&quot;));</pre></noscript></p> <h2>4. Use client side templates to render content</h2> <p>Again, this can go into another blog post by itself, and I&#39;ll be writing about this soon.</p> <p><em>The Trap:</em>Having your server return HTML output as the response to an AJAX request, and having the client just dump it into the DOM somewhere</p> <p><em>The Solution:</em>Use something like <a href="http://mustache.github.com/">Mustache.js</a> to render your server side template. I&#39;ll be posting more about this soon.</p> <h2>5. Test your javascript</h2> <p>Just because this is javascript, and not the backend code, does not mean that you should ignore your JS. JS faces just as many (if not loads more) regression bugs than your backend code.</p> <p><em>The Trap:</em>A lot of code without any test coverage</p> <p><em>The Solution:</em>Test your code with something like <a href="https://github.com/pivotal/jasmine/">jasmine</a>. Use one of the addons to jasmine like <a href="https://github.com/pivotal/jasmine-jquery">jasmine-jquery</a>, which lets you bootstrap your tests with a sample DOM, and then run your tests against that DOM.</p> <p>Check out the <a href="http://pivotal.github.com/jasmine/">example specs</a></p> <h2>6. MetaProgramming #ftw</h2> <p>Ruby programmers would already be familiar with some sort of metaprogramming, and JS is almost as powerful. The main feature I miss from ruby is the method_missing.</p> <p>You can open up a class and add methods: <script src="https://gist.github.com/3023040.js?file=6monkeypatch.js"></script><noscript>  <pre>String.prototype.alert = function() {<br />  alert(this);<br />};<br /><br />&quot;foobar&quot;.alert();</pre></noscript></p> <p>You can use [] like a poor man&#39;s send: <script src="https://gist.github.com/3023040.js?file=6send.js"></script><noscript>  <pre>alertFunction = this[&quot;alert&quot;];<br />alertFunction(&quot;blahblahblah&quot;); // Note that alert will no longer get the same value of this</pre></noscript></p> <p>You can also use [] to define dynamic methods: <script src="https://gist.github.com/3023040.js?file=6define.js"></script><noscript>  <pre>for(i = 0; i &lt; 5; i++) { <br />  var times = i; // need to save this in our closure<br />  String.prototype[&quot;alert&quot; + i] = function() {<br />    alert(this + times);<br />  }<br />};<br /><br />&quot;foobar&quot;.alert3()</pre></noscript></p> <h2>7. Know your javascript libraries</h2> <p>This could cover multiple blog posts in itself.</p> <p>Know your options for manipulating the DOM, as well as other things you want to do</p> <p>As a primer, check out the following projects:</p> <ul><li><a href="http://knockoutjs.com/">knockout.js</a></li><li><a href="http://emberjs.com/">ember.js</a> (formerly SproutCore)</li><li><a href="http://backbonejs.org/">backbone.js</a></li><li><a href="http://underscorejs.org/">underscore.js</a></li></ul> <h2>8. Use CoffeeScript</h2> <p>CoffeeScript is a neat little language that compiles down to JS, and has support for almost all of these features baked right in. It namespaces things for you, and fixes the this/self problem, and provides a lot of the functionality that underscore would provide.</p> <p>As an additional benefit, it&#39;s much less code to read. And it&#39;s baked right into rails.</p> <p>You can read more on <a href="http://coffeescript.org/">coffeescript.org</a></p> <p><hr /><b>If you liked this post, you could:</b><br /> <h4 style="text-align: center;">  <a class="twitter-follow-button" data-show-count="false" href="https://twitter.com/tdinkar">Follow @tdinkar</a></h4> <div style="text-align: center;">  <b><a href="http://news.ycombinator.com/item?id=4194066">upvote it</a> on Hacker News</b></div> <div style="text-align: center;">  <b>or just <a href="http://www.blogger.com/comment.g?blogID=9188785269813520484&postID=9116171307565451943">leave a comment</a></b></div> <br/></p><div class="author">
  <img src="http://nilenso.com/people/tejas-200.png" style="width: 96px; height: 96;">
  <span style="position: absolute; padding: 32px 15px;">
    <i>Original post by <a href="http://twitter.com/">Tejas Dinkar</a> - check out <a href="http://blog.gja.in/">Advice about nothing</a></i>
  </span>
</div>
